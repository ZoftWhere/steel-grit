<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <title>Steel Grit</title>

    <link rel="icon" href="/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="stylesheet" href="/bootstrap-4.6.0.min.css">
</head>
<body class="d-flex align-items-start flex-column" style="height: 100vh; margin-bottom: 0; border: 0;">

<div id="north" class="w-100">
    <nav class="navbar navbar-expand-md skinny" style="border-bottom: 1px solid black">
        <a class="navbar-brand" style="padding-left: 10px;" href=""><b>Steel Grit</b></a>

        <div class="p-2 flex-fill"></div>

        <nav class="nav nav-masthead justify-content-center">
            <div class="skinny">
                <button class="btn btn-outline-success" id="loadingButton">Login</button>
            </div>
        </nav>
    </nav>
</div>

<div id="input" class="w-100" style="padding: 5px; background-color: #fff;">
    <form id="prompt-form" class="input-group">
        <label for="console-input"></label>
        <input type="text" id="console-input" name="runGroup" autofocus class="d-flex flex-grow-1" autocomplete="off">
    </form>
</div>

<div id="queryResult" class="w-100">
</div>

<div id="south" class="d-flex mb-auto flex-column box-shadow w-100 scroll-view-container">
    <!--/* Empty div to fill the top (when needed). */-->
    <div class="mb-auto w-100"></div>
    <div class="w-100 scroll-view-item" id="console">
    </div>
</div>

<!--/* Preserve the order of these JavaScript libraries for Bootstrap to work. */-->
<script src="/jquery-3.5.1.min.js"></script>
<script src="/popper-1.16.1.min.js"></script>
<script src="/bootstrap-4.6.0.min.js"></script>

<script type="text/javascript" language="JavaScript">
    const promptForm = $("form#prompt-form");
    const promptInput = $("input#console-input");

    promptForm.bind("submit", function () {

        const lastInput = promptInput.val();
        const expression = lastInput;
        const token = 'base64TestToken';

        disablePrompt();

        $.ajax({
            type: "POST",
            url: "/query",
            contentType: "application/json; charset=utf-8",
            dataType: 'html',
            async: true,
            data: JSON.stringify({"input": expression}),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('Authorization', "Bearer " + token);
            }
        }).done(function (data) {
            // promptInput.val("");
            try {
                $('#queryResult').replaceWith(data);
            } catch (e) {
                console.error(e);
            } finally {
                enablePrompt();
            }
        }).fail(function (status, error) {
            console.log("Fail status: " + JSON.stringify(status));
            console.log("Fail error: " + JSON.stringify(error));
            enablePrompt();
        });

        return false;
    });

    function disablePrompt() {
        promptInput.addClass("disabled");
        promptInput.attr('disabled', 'disabled');
        promptInput.prop('disabled', true);
    }

    function enablePrompt() {
        promptInput.prop('disabled', false);
        promptInput.attr('disabled', null);
        promptInput.removeClass("disabled");
    }
</script>

</body>
</html>